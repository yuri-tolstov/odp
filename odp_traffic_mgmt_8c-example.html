<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>API Reference Manual: odp_traffic_mgmt.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="odpdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ODP-Logo-HQ.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">API Reference Manual
   &#160;<span id="projectnumber">1.24.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('odp_traffic_mgmt_8c-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">odp_traffic_mgmt.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Traffic manager example application</p>
<div class="fragment"><div class="line"><span class="comment">/* Copyright 2015 EZchip Semiconductor Ltd. All Rights Reserved.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Copyright (c) 2015-2018, Linaro Limited</span></div><div class="line"><span class="comment"> * All rights reserved.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * SPDX-License-Identifier: BSD-3-Clause</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define _GNU_SOURCE</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;execinfo.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/resource.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="odp__api_8h.html">odp_api.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define NUM_SVC_CLASSES     4</span></div><div class="line"><span class="preprocessor">#define USERS_PER_SVC_CLASS 2</span></div><div class="line"><span class="preprocessor">#define APPS_PER_USER       2</span></div><div class="line"><span class="preprocessor">#define TM_QUEUES_PER_APP   2</span></div><div class="line"><span class="preprocessor">#define NUM_USERS           (USERS_PER_SVC_CLASS * NUM_SVC_CLASSES)</span></div><div class="line"><span class="preprocessor">#define NUM_TM_QUEUES       (NUM_USERS * APPS_PER_USER * TM_QUEUES_PER_APP)</span></div><div class="line"><span class="preprocessor">#define TM_QUEUES_PER_USER  (TM_QUEUES_PER_APP * APPS_PER_USER)</span></div><div class="line"><span class="preprocessor">#define TM_QUEUES_PER_CLASS (USERS_PER_SVC_CLASS * TM_QUEUES_PER_USER)</span></div><div class="line"><span class="preprocessor">#define MAX_NODES_PER_LEVEL (NUM_USERS * APPS_PER_USER)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define KBPS   1000</span></div><div class="line"><span class="preprocessor">#define MBPS   1000000</span></div><div class="line"><span class="preprocessor">#define PERCENT(percent)  (100 * percent)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define FALSE  0</span></div><div class="line"><span class="preprocessor">#define TRUE   1</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MAX(a, b) (((a) &gt; (b)) ? (a) : (b))</span></div><div class="line"><span class="preprocessor">#define MIN(a, b) (((a) &lt; (b)) ? (a) : (b))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define RANDOM_BUF_LEN  1024</span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line">    <a name="_a0"></a><a class="code" href="structodp__tm__shaper__params__t.html">odp_tm_shaper_params_t</a>    shaper_params;</div><div class="line">    <a name="_a1"></a><a class="code" href="structodp__tm__threshold__params__t.html">odp_tm_threshold_params_t</a> threshold_params;</div><div class="line">    <a name="_a2"></a><a class="code" href="structodp__tm__wred__params__t.html">odp_tm_wred_params_t</a>      wred_params[ODP_NUM_PACKET_COLORS];</div><div class="line">} profile_params_set_t;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line">    <a class="code" href="group__odp__traffic__mngr.html#gaffb5fa3cf7196e7adbba01a87772594c">odp_tm_shaper_t</a>    shaper_profile;</div><div class="line">    <a class="code" href="group__odp__traffic__mngr.html#gabdf7a62e7ee81dfbe45234a159182da7">odp_tm_threshold_t</a> threshold_profile;</div><div class="line">    <a class="code" href="group__odp__traffic__mngr.html#ga2e017a2a1932a2d068f9c0e2546d3363">odp_tm_wred_t</a>      wred_profiles[ODP_NUM_PACKET_COLORS];</div><div class="line">} profile_set_t;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a name="_a3"></a><a class="code" href="structodp__init__t.html">odp_init_t</a> ODP_INIT_PARAMS = {</div><div class="line">    .<a name="a4"></a><a class="code" href="structodp__init__t.html#a0b40bdfeccdf0b2421f4f233276297d4">log_fn</a>   = <a name="a5"></a><a class="code" href="group__odp__initialization.html#ga56b2abf739ff5c5c09693120abb4c3a3">odp_override_log</a>,</div><div class="line">    .abort_fn = <a name="a6"></a><a class="code" href="group__odp__initialization.html#ga410b86822e9ec92b55d99ba94f9f3ec2">odp_override_abort</a></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> profile_params_set_t COMPANY_PROFILE_PARAMS = {</div><div class="line">    .shaper_params = {</div><div class="line">        .commit_bps = 50  * MBPS,  .commit_burst      = 1000000,</div><div class="line">        .peak_bps   = 0,           .peak_burst        = 0,</div><div class="line">        .dual_rate  = FALSE,       .shaper_len_adjust = 20</div><div class="line">    },</div><div class="line"></div><div class="line">    .threshold_params = {</div><div class="line">        .max_pkts  = 100000,    .enable_max_pkts  = TRUE,</div><div class="line">        .max_bytes = 10000000,  .enable_max_bytes = TRUE</div><div class="line">    },</div><div class="line"></div><div class="line">    .wred_params = {</div><div class="line">        [ODP_PACKET_GREEN ... ODP_PACKET_YELLOW] = {</div><div class="line">            .min_threshold     = PERCENT(70),</div><div class="line">            .med_threshold     = PERCENT(90),</div><div class="line">            .med_drop_prob     = PERCENT(80),</div><div class="line">            .max_drop_prob     = PERCENT(100),</div><div class="line">            .enable_wred       = TRUE,</div><div class="line">            .use_byte_fullness = FALSE,</div><div class="line">        },</div><div class="line"></div><div class="line">        [ODP_PACKET_RED] = {</div><div class="line">            .min_threshold     = PERCENT(40),</div><div class="line">            .med_threshold     = PERCENT(70),</div><div class="line">            .med_drop_prob     = PERCENT(70),</div><div class="line">            .max_drop_prob     = PERCENT(100),</div><div class="line">            .enable_wred       = TRUE,</div><div class="line">            .use_byte_fullness = FALSE,</div><div class="line">        },</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> profile_params_set_t COS0_PROFILE_PARAMS = {</div><div class="line">    .shaper_params = {</div><div class="line">        .commit_bps = 1 * MBPS,  .commit_burst      = 100000,</div><div class="line">        .peak_bps   = 4 * MBPS,  .peak_burst        = 200000,</div><div class="line">        .dual_rate  = FALSE,     .shaper_len_adjust = 20</div><div class="line">    },</div><div class="line"></div><div class="line">    .threshold_params = {</div><div class="line">        .max_pkts  = 10000,    .enable_max_pkts  = TRUE,</div><div class="line">        .max_bytes = 1000000,  .enable_max_bytes = TRUE</div><div class="line">    },</div><div class="line"></div><div class="line">    .wred_params = {</div><div class="line">        [ODP_PACKET_GREEN ... ODP_PACKET_YELLOW] = {</div><div class="line">            .min_threshold     = PERCENT(80),</div><div class="line">            .med_threshold     = PERCENT(90),</div><div class="line">            .med_drop_prob     = PERCENT(50),</div><div class="line">            .max_drop_prob     = PERCENT(100),</div><div class="line">            .enable_wred       = TRUE,</div><div class="line">            .use_byte_fullness = FALSE,</div><div class="line">        },</div><div class="line"></div><div class="line">        [ODP_PACKET_RED] = {</div><div class="line">            .min_threshold     = PERCENT(60),</div><div class="line">            .med_threshold     = PERCENT(80),</div><div class="line">            .med_drop_prob     = PERCENT(70),</div><div class="line">            .max_drop_prob     = PERCENT(100),</div><div class="line">            .enable_wred       = TRUE,</div><div class="line">            .use_byte_fullness = FALSE,</div><div class="line">        },</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> profile_params_set_t COS1_PROFILE_PARAMS = {</div><div class="line">    .shaper_params = {</div><div class="line">        .commit_bps = 500  * KBPS,  .commit_burst      = 50000,</div><div class="line">        .peak_bps   = 1500 * KBPS,  .peak_burst        = 150000,</div><div class="line">        .dual_rate  = FALSE,        .shaper_len_adjust = 20</div><div class="line">    },</div><div class="line"></div><div class="line">    .threshold_params = {</div><div class="line">        .max_pkts  = 5000,    .enable_max_pkts  = TRUE,</div><div class="line">        .max_bytes = 500000,  .enable_max_bytes = TRUE</div><div class="line">    },</div><div class="line"></div><div class="line">    .wred_params = {</div><div class="line">        [ODP_PACKET_GREEN ... ODP_PACKET_YELLOW] = {</div><div class="line">            .min_threshold     = PERCENT(40),</div><div class="line">            .med_threshold     = PERCENT(90),</div><div class="line">            .med_drop_prob     = PERCENT(70),</div><div class="line">            .max_drop_prob     = PERCENT(100),</div><div class="line">            .enable_wred       = TRUE,</div><div class="line">            .use_byte_fullness = FALSE,</div><div class="line">        },</div><div class="line"></div><div class="line">        [ODP_PACKET_RED] = {</div><div class="line">            .min_threshold     = PERCENT(50),</div><div class="line">            .med_threshold     = PERCENT(80),</div><div class="line">            .med_drop_prob     = PERCENT(80),</div><div class="line">            .max_drop_prob     = PERCENT(100),</div><div class="line">            .enable_wred       = TRUE,</div><div class="line">            .use_byte_fullness = FALSE,</div><div class="line">        },</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> profile_params_set_t COS2_PROFILE_PARAMS = {</div><div class="line">    .shaper_params = {</div><div class="line">        .commit_bps = 200 * KBPS,  .commit_burst      = 20000,</div><div class="line">        .peak_bps   = 400 * KBPS,  .peak_burst        = 40000,</div><div class="line">        .dual_rate  = FALSE,       .shaper_len_adjust = 20</div><div class="line">    },</div><div class="line"></div><div class="line">    .threshold_params = {</div><div class="line">        .max_pkts  = 1000,    .enable_max_pkts  = TRUE,</div><div class="line">        .max_bytes = 100000,  .enable_max_bytes = TRUE</div><div class="line">    },</div><div class="line"></div><div class="line">    .wred_params = {</div><div class="line">        [ODP_PACKET_GREEN ... ODP_PACKET_YELLOW] = {</div><div class="line">            .min_threshold     = PERCENT(50),</div><div class="line">            .med_threshold     = PERCENT(80),</div><div class="line">            .med_drop_prob     = PERCENT(70),</div><div class="line">            .max_drop_prob     = PERCENT(100),</div><div class="line">            .enable_wred       = TRUE,</div><div class="line">            .use_byte_fullness = FALSE,</div><div class="line">        },</div><div class="line"></div><div class="line">        [ODP_PACKET_RED] = {</div><div class="line">            .min_threshold     = PERCENT(40),</div><div class="line">            .med_threshold     = PERCENT(70),</div><div class="line">            .med_drop_prob     = PERCENT(80),</div><div class="line">            .max_drop_prob     = PERCENT(100),</div><div class="line">            .enable_wred       = TRUE,</div><div class="line">            .use_byte_fullness = FALSE,</div><div class="line">        },</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> profile_params_set_t COS3_PROFILE_PARAMS = {</div><div class="line">    .shaper_params = {</div><div class="line">        .commit_bps = 100 * KBPS,  .commit_burst      = 5000,</div><div class="line">        .peak_bps   = 0,           .peak_burst        = 0,</div><div class="line">        .dual_rate  = FALSE,       .shaper_len_adjust = 20</div><div class="line">    },</div><div class="line"></div><div class="line">    .threshold_params = {</div><div class="line">        .max_pkts  = 400,    .enable_max_pkts  = TRUE,</div><div class="line">        .max_bytes = 60000,  .enable_max_bytes = TRUE</div><div class="line">    },</div><div class="line"></div><div class="line">    .wred_params = {</div><div class="line">        [ODP_PACKET_GREEN ... ODP_PACKET_YELLOW] = {</div><div class="line">            .min_threshold     = PERCENT(40),</div><div class="line">            .med_threshold     = PERCENT(70),</div><div class="line">            .med_drop_prob     = PERCENT(80),</div><div class="line">            .max_drop_prob     = PERCENT(100),</div><div class="line">            .enable_wred       = TRUE,</div><div class="line">            .use_byte_fullness = FALSE,</div><div class="line">        },</div><div class="line"></div><div class="line">        [ODP_PACKET_RED] = {</div><div class="line">            .min_threshold     = PERCENT(30),</div><div class="line">            .med_threshold     = PERCENT(60),</div><div class="line">            .med_drop_prob     = PERCENT(80),</div><div class="line">            .max_drop_prob     = PERCENT(100),</div><div class="line">            .enable_wred       = TRUE,</div><div class="line">            .use_byte_fullness = FALSE,</div><div class="line">        },</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> profile_set_t COMPANY_PROFILE_SET;</div><div class="line"><span class="keyword">static</span> profile_set_t COS_PROFILE_SETS[NUM_SVC_CLASSES];</div><div class="line"><span class="keyword">static</span> profile_set_t USER_PROFILE_SETS[NUM_SVC_CLASSES];</div><div class="line"><span class="keyword">static</span> profile_set_t APP_PROFILE_SETS[NUM_SVC_CLASSES][APPS_PER_USER];</div><div class="line"></div><div class="line"><span class="keyword">static</span> <a class="code" href="group__odp__traffic__mngr.html#ga245197132dbbcf8724733789a97de6f2">odp_tm_t</a> odp_tm_test;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <a name="_a7"></a><a class="code" href="struct__odp__abi__pool__t.html">odp_pool_t</a> odp_pool;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <a class="code" href="group__odp__traffic__mngr.html#ga6c2eab533f6a147a756601b996fc6c1c">odp_tm_queue_t</a> queue_num_tbls[NUM_SVC_CLASSES][TM_QUEUES_PER_CLASS];</div><div class="line"><span class="keyword">static</span> uint32_t       next_queue_nums[NUM_SVC_CLASSES];</div><div class="line"></div><div class="line"><span class="keyword">static</span> uint8_t  random_buf[RANDOM_BUF_LEN];</div><div class="line"><span class="keyword">static</span> uint32_t next_rand_byte;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <a name="_a8"></a><a class="code" href="structodp__atomic__u32__s.html">odp_atomic_u32_t</a> atomic_pkts_into_tm;</div><div class="line"><span class="keyword">static</span> <a class="code" href="structodp__atomic__u32__s.html">odp_atomic_u32_t</a> atomic_pkts_from_tm;</div><div class="line"></div><div class="line"><span class="keyword">static</span> uint32_t g_num_pkts_to_send = 1000;</div><div class="line"><span class="keyword">static</span> uint8_t  g_print_tm_stats   = TRUE;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> tester_egress_fcn(<a name="_a9"></a><a class="code" href="struct__odp__abi__packet__t.html">odp_packet_t</a> odp_pkt);</div><div class="line"></div><div class="line"><span class="comment">/* Returns the number of errors encountered. */</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> uint32_t create_profile_set(profile_params_set_t *profile_params_set,</div><div class="line">                   profile_set_t        *profile_set,</div><div class="line">                   <span class="keyword">const</span> <span class="keywordtype">char</span>           *base_name,</div><div class="line">                   uint32_t              name_idx,</div><div class="line">                   uint32_t              shaper_scale,</div><div class="line">                   uint32_t              threshold_scale)</div><div class="line">{</div><div class="line">    <a class="code" href="structodp__tm__threshold__params__t.html">odp_tm_threshold_params_t</a> threshold_params, *thresholds;</div><div class="line">    <a class="code" href="structodp__tm__shaper__params__t.html">odp_tm_shaper_params_t</a>    shaper_params, *shaper;</div><div class="line">    <a class="code" href="structodp__tm__wred__params__t.html">odp_tm_wred_params_t</a>      wred_params, *wred;</div><div class="line">    uint32_t                  err_cnt, color;</div><div class="line">    <span class="keywordtype">char</span>                      name[64], wred_name[64];</div><div class="line"></div><div class="line">    err_cnt = 0;</div><div class="line">    <span class="keywordflow">if</span> (name_idx == 0)</div><div class="line">        snprintf(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;%s&quot;</span>, base_name);</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">        snprintf(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;%s-%&quot;</span> PRIu32,</div><div class="line">             base_name, name_idx);</div><div class="line"></div><div class="line">    <a name="a10"></a><a class="code" href="group__odp__traffic__mngr.html#ga86e5d0761145bc21370dc8a47b2a76da">odp_tm_shaper_params_init</a>(&amp;shaper_params);</div><div class="line">    shaper                          = &amp;profile_params_set-&gt;shaper_params;</div><div class="line">    shaper_params.<a name="a11"></a><a class="code" href="structodp__tm__shaper__params__t.html#ac565bd668bc7bbd2f49bb3593df742c4">commit_bps</a>        = shaper-&gt;<a class="code" href="structodp__tm__shaper__params__t.html#ac565bd668bc7bbd2f49bb3593df742c4">commit_bps</a>   * shaper_scale;</div><div class="line">    shaper_params.<a name="a12"></a><a class="code" href="structodp__tm__shaper__params__t.html#afc421165be7a8ecf00d73ed40692b08b">peak_bps</a>          = shaper-&gt;<a class="code" href="structodp__tm__shaper__params__t.html#afc421165be7a8ecf00d73ed40692b08b">peak_bps</a>     * shaper_scale;</div><div class="line">    shaper_params.<a name="a13"></a><a class="code" href="structodp__tm__shaper__params__t.html#a3bb3cc9e398032caf17bdac9c051a7fb">commit_burst</a>      = shaper-&gt;<a class="code" href="structodp__tm__shaper__params__t.html#a3bb3cc9e398032caf17bdac9c051a7fb">commit_burst</a> * shaper_scale;</div><div class="line">    shaper_params.<a name="a14"></a><a class="code" href="structodp__tm__shaper__params__t.html#ad66a0defa11756059fb22fc5c2b1cd3b">peak_burst</a>        = shaper-&gt;<a class="code" href="structodp__tm__shaper__params__t.html#ad66a0defa11756059fb22fc5c2b1cd3b">peak_burst</a>   * shaper_scale;</div><div class="line">    shaper_params.<a name="a15"></a><a class="code" href="structodp__tm__shaper__params__t.html#a60062ae989360def14a182e58b36d00d">dual_rate</a>         = shaper-&gt;<a class="code" href="structodp__tm__shaper__params__t.html#a60062ae989360def14a182e58b36d00d">dual_rate</a>;</div><div class="line">    shaper_params.<a name="a16"></a><a class="code" href="structodp__tm__shaper__params__t.html#a8d6d986b9b8932c0dc4f536e2c816304">shaper_len_adjust</a> = shaper-&gt;<a class="code" href="structodp__tm__shaper__params__t.html#a8d6d986b9b8932c0dc4f536e2c816304">shaper_len_adjust</a>;</div><div class="line">    profile_set-&gt;shaper_profile     = <a name="a17"></a><a class="code" href="group__odp__traffic__mngr.html#ga88e055cb1444a385c3bafca90fde5c6a">odp_tm_shaper_create</a>(name,</div><div class="line">                                   &amp;shaper_params);</div><div class="line">    <span class="keywordflow">if</span> (profile_set-&gt;shaper_profile == <a name="a18"></a><a class="code" href="group__odp__traffic__mngr.html#gaae1e9e4d81b4cba0ddfc07a389ef44c7">ODP_TM_INVALID</a>)</div><div class="line">        err_cnt++;</div><div class="line"></div><div class="line">    <a name="a19"></a><a class="code" href="group__odp__traffic__mngr.html#gac39f2b06785b27203dc79170a5c44b4e">odp_tm_threshold_params_init</a>(&amp;threshold_params);</div><div class="line">    thresholds = &amp;profile_params_set-&gt;threshold_params;</div><div class="line">    threshold_params.<a name="a20"></a><a class="code" href="structodp__tm__threshold__params__t.html#ad7e9b060008957d13c956c0751c21804">max_pkts</a> = thresholds-&gt;<a class="code" href="structodp__tm__threshold__params__t.html#ad7e9b060008957d13c956c0751c21804">max_pkts</a>  * threshold_scale;</div><div class="line">    threshold_params.<a name="a21"></a><a class="code" href="structodp__tm__threshold__params__t.html#a392ba9ce41e92baabfde295fd247bf12">max_bytes</a> = thresholds-&gt;<a class="code" href="structodp__tm__threshold__params__t.html#a392ba9ce41e92baabfde295fd247bf12">max_bytes</a> * threshold_scale;</div><div class="line">    threshold_params.<a name="a22"></a><a class="code" href="structodp__tm__threshold__params__t.html#aaf4d372acb5c1bd96c0a5ef86b62055f">enable_max_pkts</a>  = thresholds-&gt;<a class="code" href="structodp__tm__threshold__params__t.html#aaf4d372acb5c1bd96c0a5ef86b62055f">enable_max_pkts</a>;</div><div class="line">    threshold_params.<a name="a23"></a><a class="code" href="structodp__tm__threshold__params__t.html#a50f3a43740fb2d9472c7a28f3339aa74">enable_max_bytes</a> = thresholds-&gt;<a class="code" href="structodp__tm__threshold__params__t.html#a50f3a43740fb2d9472c7a28f3339aa74">enable_max_bytes</a>;</div><div class="line">    profile_set-&gt;threshold_profile =</div><div class="line">        <a name="a24"></a><a class="code" href="group__odp__traffic__mngr.html#ga1c3e40337ecc5316b9e5092d04bdc0b3">odp_tm_threshold_create</a>(name, &amp;threshold_params);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (profile_set-&gt;threshold_profile == <a class="code" href="group__odp__traffic__mngr.html#gaae1e9e4d81b4cba0ddfc07a389ef44c7">ODP_TM_INVALID</a>)</div><div class="line">        err_cnt++;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (color = 0; color &lt; ODP_NUM_PACKET_COLORS; color++) {</div><div class="line">        snprintf(wred_name, <span class="keyword">sizeof</span>(wred_name), <span class="stringliteral">&quot;%s-%&quot;</span> PRIu32,</div><div class="line">             name, color);</div><div class="line"></div><div class="line">        <a name="a25"></a><a class="code" href="group__odp__traffic__mngr.html#gad7b9b2094930387f73db2a2085041068">odp_tm_wred_params_init</a>(&amp;wred_params);</div><div class="line">        wred = &amp;profile_params_set-&gt;wred_params[color];</div><div class="line">        wred_params.<a name="a26"></a><a class="code" href="structodp__tm__wred__params__t.html#ad66d82e555de17121235c33c2579339d">min_threshold</a>     = wred-&gt;<a class="code" href="structodp__tm__wred__params__t.html#ad66d82e555de17121235c33c2579339d">min_threshold</a>;</div><div class="line">        wred_params.<a name="a27"></a><a class="code" href="structodp__tm__wred__params__t.html#a7f5d20643c41cf38a21472ead4d3423a">med_threshold</a>     = wred-&gt;<a class="code" href="structodp__tm__wred__params__t.html#a7f5d20643c41cf38a21472ead4d3423a">med_threshold</a>;</div><div class="line">        wred_params.<a name="a28"></a><a class="code" href="structodp__tm__wred__params__t.html#a359fabde4e477c19f2ca7087beefc9ae">med_drop_prob</a>     = wred-&gt;<a class="code" href="structodp__tm__wred__params__t.html#a359fabde4e477c19f2ca7087beefc9ae">med_drop_prob</a>;</div><div class="line">        wred_params.<a name="a29"></a><a class="code" href="structodp__tm__wred__params__t.html#ad65d2ee6c786acd78a44c0a9de2d2860">max_drop_prob</a>     = wred-&gt;<a class="code" href="structodp__tm__wred__params__t.html#ad65d2ee6c786acd78a44c0a9de2d2860">max_drop_prob</a>;</div><div class="line">        wred_params.<a name="a30"></a><a class="code" href="structodp__tm__wred__params__t.html#a8fdc744a86f73dbc38c8c2c086604808">enable_wred</a>       = wred-&gt;<a class="code" href="structodp__tm__wred__params__t.html#a8fdc744a86f73dbc38c8c2c086604808">enable_wred</a>;</div><div class="line">        wred_params.<a name="a31"></a><a class="code" href="structodp__tm__wred__params__t.html#a5944fe8f31893aaeb0b3b68b3834fd0b">use_byte_fullness</a> = wred-&gt;<a class="code" href="structodp__tm__wred__params__t.html#a5944fe8f31893aaeb0b3b68b3834fd0b">use_byte_fullness</a>;</div><div class="line">        profile_set-&gt;wred_profiles[color] =</div><div class="line">            <a name="a32"></a><a class="code" href="group__odp__traffic__mngr.html#ga2108cf17cbf69177ec36aa8a89881d50">odp_tm_wred_create</a>(wred_name, &amp;wred_params);</div><div class="line">        <span class="keywordflow">if</span> (profile_set-&gt;wred_profiles[color] == <a class="code" href="group__odp__traffic__mngr.html#gaae1e9e4d81b4cba0ddfc07a389ef44c7">ODP_TM_INVALID</a>)</div><div class="line">            err_cnt++;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> err_cnt;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/* Returns the number of errors encountered. */</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> uint32_t init_profile_sets(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    uint32_t class_shaper_scale, class_threshold_scale, user_shaper_scale;</div><div class="line">    uint32_t user_threshold_scale, err_cnt, app_idx;</div><div class="line"></div><div class="line">    class_shaper_scale    = TM_QUEUES_PER_CLASS / 2;</div><div class="line">    class_threshold_scale = TM_QUEUES_PER_CLASS;</div><div class="line">    user_shaper_scale     = TM_QUEUES_PER_USER / 2;</div><div class="line">    user_threshold_scale  = TM_QUEUES_PER_USER;</div><div class="line">    err_cnt               = 0;</div><div class="line"></div><div class="line">    err_cnt += create_profile_set(&amp;COMPANY_PROFILE_PARAMS,</div><div class="line">                      &amp;COMPANY_PROFILE_SET,</div><div class="line">                      <span class="stringliteral">&quot;CompanyProfiles&quot;</span>, 0, 1, 1);</div><div class="line"></div><div class="line">    err_cnt += create_profile_set(&amp;COS0_PROFILE_PARAMS,</div><div class="line">                      &amp;COS_PROFILE_SETS[0], <span class="stringliteral">&quot;ServiceClass0&quot;</span>, 0,</div><div class="line">                      class_shaper_scale,</div><div class="line">                      class_threshold_scale);</div><div class="line">    err_cnt += create_profile_set(&amp;COS1_PROFILE_PARAMS,</div><div class="line">                      &amp;COS_PROFILE_SETS[1], <span class="stringliteral">&quot;ServiceClass1&quot;</span>, 0,</div><div class="line">                      class_shaper_scale,</div><div class="line">                      class_threshold_scale);</div><div class="line">    err_cnt += create_profile_set(&amp;COS2_PROFILE_PARAMS,</div><div class="line">                      &amp;COS_PROFILE_SETS[2], <span class="stringliteral">&quot;ServiceClass2&quot;</span>, 0,</div><div class="line">                      class_shaper_scale,</div><div class="line">                      class_threshold_scale);</div><div class="line">    err_cnt += create_profile_set(&amp;COS3_PROFILE_PARAMS,</div><div class="line">                      &amp;COS_PROFILE_SETS[3], <span class="stringliteral">&quot;ServiceClass3&quot;</span>, 0,</div><div class="line">                      class_shaper_scale,</div><div class="line">                      class_threshold_scale);</div><div class="line"></div><div class="line">    err_cnt += create_profile_set(&amp;COS0_PROFILE_PARAMS,</div><div class="line">                      &amp;USER_PROFILE_SETS[0], <span class="stringliteral">&quot;UserSvc0&quot;</span>, 0,</div><div class="line">                      user_shaper_scale, user_threshold_scale);</div><div class="line">    err_cnt += create_profile_set(&amp;COS1_PROFILE_PARAMS,</div><div class="line">                      &amp;USER_PROFILE_SETS[1], <span class="stringliteral">&quot;UserSvc1&quot;</span>, 0,</div><div class="line">                      user_shaper_scale, user_threshold_scale);</div><div class="line">    err_cnt += create_profile_set(&amp;COS2_PROFILE_PARAMS,</div><div class="line">                      &amp;USER_PROFILE_SETS[2], <span class="stringliteral">&quot;UserSvc2&quot;</span>, 0,</div><div class="line">                      user_shaper_scale, user_threshold_scale);</div><div class="line">    err_cnt += create_profile_set(&amp;COS3_PROFILE_PARAMS,</div><div class="line">                      &amp;USER_PROFILE_SETS[3], <span class="stringliteral">&quot;UserSvc3&quot;</span>, 0,</div><div class="line">                      user_shaper_scale, user_threshold_scale);</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (app_idx = 0; app_idx &lt; APPS_PER_USER; app_idx++) {</div><div class="line">        err_cnt += create_profile_set(&amp;COS0_PROFILE_PARAMS,</div><div class="line">                          &amp;APP_PROFILE_SETS[0][app_idx],</div><div class="line">                          <span class="stringliteral">&quot;AppSvc0&quot;</span>, app_idx + 1, 1, 1);</div><div class="line">        err_cnt += create_profile_set(&amp;COS1_PROFILE_PARAMS,</div><div class="line">                          &amp;APP_PROFILE_SETS[1][app_idx],</div><div class="line">                          <span class="stringliteral">&quot;AppSvc1&quot;</span>, app_idx + 1, 1, 1);</div><div class="line">        err_cnt += create_profile_set(&amp;COS2_PROFILE_PARAMS,</div><div class="line">                          &amp;APP_PROFILE_SETS[2][app_idx],</div><div class="line">                          <span class="stringliteral">&quot;AppSvc2&quot;</span>, app_idx + 1, 1, 1);</div><div class="line">        err_cnt += create_profile_set(&amp;COS3_PROFILE_PARAMS,</div><div class="line">                          &amp;APP_PROFILE_SETS[3][app_idx],</div><div class="line">                          <span class="stringliteral">&quot;AppSvc3&quot;</span>, app_idx + 1, 1, 1);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> err_cnt;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> config_example_user(<a class="code" href="group__odp__traffic__mngr.html#ga437c3e0d6468eaa3884f81b587d23a85">odp_tm_node_t</a> cos_tm_node,</div><div class="line">                   uint8_t       svc_class,</div><div class="line">                   uint32_t      user_num)</div><div class="line">{</div><div class="line">    <a name="_a33"></a><a class="code" href="structodp__tm__queue__params__t.html">odp_tm_queue_params_t</a> tm_queue_params;</div><div class="line">    <a name="_a34"></a><a class="code" href="structodp__tm__node__params__t.html">odp_tm_node_params_t</a>  tm_node_params;</div><div class="line">    <a class="code" href="group__odp__traffic__mngr.html#ga6c2eab533f6a147a756601b996fc6c1c">odp_tm_queue_t</a>        tm_queue;</div><div class="line">    <a class="code" href="group__odp__traffic__mngr.html#ga437c3e0d6468eaa3884f81b587d23a85">odp_tm_node_t</a>         user_tm_node;</div><div class="line">    profile_set_t        *profile_set;</div><div class="line">    uint32_t              app_idx, queue_idx, svc_class_queue_num;</div><div class="line">    <span class="keywordtype">char</span>                  user_name[64];</div><div class="line">    <span class="keywordtype">int</span>                   rc;</div><div class="line"></div><div class="line">    profile_set = &amp;USER_PROFILE_SETS[svc_class];</div><div class="line"></div><div class="line">    <a name="a35"></a><a class="code" href="group__odp__traffic__mngr.html#ga41626ebd4faff23653a15c07456654b6">odp_tm_node_params_init</a>(&amp;tm_node_params);</div><div class="line">    tm_node_params.<a name="a36"></a><a class="code" href="structodp__tm__node__params__t.html#a1f8406ff5b998d00736c0d53bc28039a">max_fanin</a>         = 64;</div><div class="line">    tm_node_params.<a name="a37"></a><a class="code" href="structodp__tm__node__params__t.html#a11a79646a6bfab406b678d36d8999a12">shaper_profile</a>    = profile_set-&gt;shaper_profile;</div><div class="line">    tm_node_params.<a name="a38"></a><a class="code" href="structodp__tm__node__params__t.html#a22ab8bd23f17a21b4326cc4c36e6b8ba">threshold_profile</a> = profile_set-&gt;threshold_profile;</div><div class="line">    tm_node_params.<a name="a39"></a><a class="code" href="structodp__tm__node__params__t.html#a63a38460526fc6297d1245201563e277">wred_profile</a>[ODP_PACKET_GREEN] =</div><div class="line">        profile_set-&gt;wred_profiles[0];</div><div class="line">    tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a63a38460526fc6297d1245201563e277">wred_profile</a>[ODP_PACKET_YELLOW] =</div><div class="line">        profile_set-&gt;wred_profiles[1];</div><div class="line">    tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a63a38460526fc6297d1245201563e277">wred_profile</a>[ODP_PACKET_RED] =</div><div class="line">        profile_set-&gt;wred_profiles[2];</div><div class="line">    tm_node_params.<a name="a40"></a><a class="code" href="structodp__tm__node__params__t.html#a597e5c302f167078db1dfd1b847927ce">level</a>                    = 2;</div><div class="line"></div><div class="line">    snprintf(user_name, <span class="keyword">sizeof</span>(user_name), <span class="stringliteral">&quot;Subscriber-%&quot;</span> PRIu32, user_num);</div><div class="line">    user_tm_node = <a name="a41"></a><a class="code" href="group__odp__traffic__mngr.html#ga822b3d84ffaccb17ee5f7948b42e7ced">odp_tm_node_create</a>(odp_tm_test, user_name,</div><div class="line">                      &amp;tm_node_params);</div><div class="line">    <a name="a42"></a><a class="code" href="group__odp__traffic__mngr.html#ga932a1cff114990cfde6b3913e61fefe3">odp_tm_node_connect</a>(user_tm_node, cos_tm_node);</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (app_idx = 0; app_idx &lt; APPS_PER_USER; app_idx++) {</div><div class="line">        profile_set = &amp;APP_PROFILE_SETS[svc_class][app_idx];</div><div class="line">        <span class="keywordflow">for</span> (queue_idx = 0; queue_idx &lt; TM_QUEUES_PER_APP;</div><div class="line">             queue_idx++) {</div><div class="line">            <a name="a43"></a><a class="code" href="group__odp__traffic__mngr.html#ga52b2c2bfe47fff819476277a849b67e9">odp_tm_queue_params_init</a>(&amp;tm_queue_params);</div><div class="line">            tm_queue_params.<a name="a44"></a><a class="code" href="structodp__tm__queue__params__t.html#af9999474f56ee1022cc9e848af40351c">shaper_profile</a> =</div><div class="line">                profile_set-&gt;shaper_profile;</div><div class="line">            tm_queue_params.<a name="a45"></a><a class="code" href="structodp__tm__queue__params__t.html#a55974c16b8fd92645c74e5cd61279b00">threshold_profile</a> =</div><div class="line">                profile_set-&gt;threshold_profile;</div><div class="line">            tm_queue_params.<a name="a46"></a><a class="code" href="structodp__tm__queue__params__t.html#ab77e46368d26c39305becc5691617081">priority</a> = svc_class;</div><div class="line"></div><div class="line">            tm_queue_params.<a name="a47"></a><a class="code" href="structodp__tm__queue__params__t.html#ae3556cc26bad5fa27a9319d2c3fd2fef">wred_profile</a>[ODP_PACKET_GREEN] =</div><div class="line">                profile_set-&gt;wred_profiles[ODP_PACKET_GREEN];</div><div class="line">            tm_queue_params.<a class="code" href="structodp__tm__queue__params__t.html#ae3556cc26bad5fa27a9319d2c3fd2fef">wred_profile</a>[ODP_PACKET_YELLOW] =</div><div class="line">                profile_set-&gt;wred_profiles[ODP_PACKET_YELLOW];</div><div class="line">            tm_queue_params.<a class="code" href="structodp__tm__queue__params__t.html#ae3556cc26bad5fa27a9319d2c3fd2fef">wred_profile</a>[ODP_PACKET_RED] =</div><div class="line">                profile_set-&gt;wred_profiles[ODP_PACKET_RED];</div><div class="line"></div><div class="line">            tm_queue = <a name="a48"></a><a class="code" href="group__odp__traffic__mngr.html#ga9d198d62ef5c93cd9044c713a9189ac5">odp_tm_queue_create</a>(odp_tm_test,</div><div class="line">                               &amp;tm_queue_params);</div><div class="line">            rc = <a name="a49"></a><a class="code" href="group__odp__traffic__mngr.html#ga5d469ba2a1831e10e80e242cd1e0af09">odp_tm_queue_connect</a>(tm_queue, user_tm_node);</div><div class="line">            <span class="keywordflow">if</span> (rc &lt; 0)</div><div class="line">                <span class="keywordflow">return</span> rc;</div><div class="line"></div><div class="line">            svc_class_queue_num = next_queue_nums[svc_class]++;</div><div class="line">            queue_num_tbls[svc_class][svc_class_queue_num] =</div><div class="line">                tm_queue;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> config_company_node(<span class="keyword">const</span> <span class="keywordtype">char</span> *company_name)</div><div class="line">{</div><div class="line">    <a class="code" href="structodp__tm__node__params__t.html">odp_tm_node_params_t</a> tm_node_params;</div><div class="line">    profile_set_t       *profile_set;</div><div class="line">    <a class="code" href="group__odp__traffic__mngr.html#ga437c3e0d6468eaa3884f81b587d23a85">odp_tm_node_t</a>        company_tm_node, cos_tm_node;</div><div class="line">    uint32_t             cos_idx, user_idx;</div><div class="line">    <span class="keywordtype">char</span>                 cos_node_name[64];</div><div class="line"></div><div class="line">    profile_set = &amp;COMPANY_PROFILE_SET;</div><div class="line">    <a class="code" href="group__odp__traffic__mngr.html#ga41626ebd4faff23653a15c07456654b6">odp_tm_node_params_init</a>(&amp;tm_node_params);</div><div class="line">    tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a1f8406ff5b998d00736c0d53bc28039a">max_fanin</a>         = 64;</div><div class="line">    tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a11a79646a6bfab406b678d36d8999a12">shaper_profile</a>    = profile_set-&gt;shaper_profile;</div><div class="line">    tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a22ab8bd23f17a21b4326cc4c36e6b8ba">threshold_profile</a> = profile_set-&gt;threshold_profile;</div><div class="line">    tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a63a38460526fc6297d1245201563e277">wred_profile</a>[ODP_PACKET_GREEN] =</div><div class="line">        profile_set-&gt;wred_profiles[0];</div><div class="line">    tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a63a38460526fc6297d1245201563e277">wred_profile</a>[ODP_PACKET_YELLOW] =</div><div class="line">        profile_set-&gt;wred_profiles[1];</div><div class="line">    tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a63a38460526fc6297d1245201563e277">wred_profile</a>[ODP_PACKET_RED] =</div><div class="line">        profile_set-&gt;wred_profiles[2];</div><div class="line">    tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a597e5c302f167078db1dfd1b847927ce">level</a>                    = 0;</div><div class="line"></div><div class="line">    company_tm_node = <a class="code" href="group__odp__traffic__mngr.html#ga822b3d84ffaccb17ee5f7948b42e7ced">odp_tm_node_create</a>(odp_tm_test, company_name,</div><div class="line">                         &amp;tm_node_params);</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (cos_idx = 0; cos_idx &lt; NUM_SVC_CLASSES; cos_idx++) {</div><div class="line">        <a class="code" href="group__odp__traffic__mngr.html#ga41626ebd4faff23653a15c07456654b6">odp_tm_node_params_init</a>(&amp;tm_node_params);</div><div class="line">        profile_set                      = &amp;COS_PROFILE_SETS[cos_idx];</div><div class="line">        tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a1f8406ff5b998d00736c0d53bc28039a">max_fanin</a>         = 64;</div><div class="line">        tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a11a79646a6bfab406b678d36d8999a12">shaper_profile</a>    = profile_set-&gt;shaper_profile;</div><div class="line">        tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a22ab8bd23f17a21b4326cc4c36e6b8ba">threshold_profile</a> =</div><div class="line">            profile_set-&gt;threshold_profile;</div><div class="line">        tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a597e5c302f167078db1dfd1b847927ce">level</a>             = 1;</div><div class="line"></div><div class="line">        tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a63a38460526fc6297d1245201563e277">wred_profile</a>[ODP_PACKET_GREEN]  =</div><div class="line">            profile_set-&gt;wred_profiles[ODP_PACKET_GREEN];</div><div class="line">        tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a63a38460526fc6297d1245201563e277">wred_profile</a>[ODP_PACKET_YELLOW] =</div><div class="line">            profile_set-&gt;wred_profiles[ODP_PACKET_YELLOW];</div><div class="line">        tm_node_params.<a class="code" href="structodp__tm__node__params__t.html#a63a38460526fc6297d1245201563e277">wred_profile</a>[ODP_PACKET_RED]    =</div><div class="line">            profile_set-&gt;wred_profiles[ODP_PACKET_RED];</div><div class="line"></div><div class="line">        snprintf(cos_node_name, <span class="keyword">sizeof</span>(cos_node_name),</div><div class="line">             <span class="stringliteral">&quot;%s-Class-%&quot;</span> PRIu32, company_name, cos_idx);</div><div class="line">        cos_tm_node = <a class="code" href="group__odp__traffic__mngr.html#ga822b3d84ffaccb17ee5f7948b42e7ced">odp_tm_node_create</a>(odp_tm_test, cos_node_name,</div><div class="line">                         &amp;tm_node_params);</div><div class="line">        <a class="code" href="group__odp__traffic__mngr.html#ga932a1cff114990cfde6b3913e61fefe3">odp_tm_node_connect</a>(cos_tm_node, company_tm_node);</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (user_idx = 0; user_idx &lt; USERS_PER_SVC_CLASS; user_idx++)</div><div class="line">            config_example_user(cos_tm_node, cos_idx,</div><div class="line">                        cos_idx * 256 + user_idx);</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group__odp__traffic__mngr.html#ga932a1cff114990cfde6b3913e61fefe3">odp_tm_node_connect</a>(company_tm_node, <a name="a50"></a><a class="code" href="group__odp__traffic__mngr.html#gaf69edb086fe448306394bcd281c0e0d4">ODP_TM_ROOT</a>);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> create_and_config_tm(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a name="_a51"></a><a class="code" href="structodp__tm__level__requirements__t.html">odp_tm_level_requirements_t</a> *per_level;</div><div class="line">    <a name="_a52"></a><a class="code" href="structodp__tm__requirements__t.html">odp_tm_requirements_t</a>        requirements;</div><div class="line">    <a name="_a53"></a><a class="code" href="structodp__tm__egress__t.html">odp_tm_egress_t</a>              egress;</div><div class="line">    uint32_t                     level, err_cnt;</div><div class="line"></div><div class="line">    <a name="a54"></a><a class="code" href="group__odp__traffic__mngr.html#gafc9bf5124198577e0313cf0f44ba49ba">odp_tm_requirements_init</a>(&amp;requirements);</div><div class="line">    <a name="a55"></a><a class="code" href="group__odp__traffic__mngr.html#ga37995e383798517f5dbfa95e1fc4fe4b">odp_tm_egress_init</a>(&amp;egress);</div><div class="line"></div><div class="line">    requirements.<a name="a56"></a><a class="code" href="structodp__tm__requirements__t.html#a2bb0554a2d1838a56681d8d2cfa68b04">max_tm_queues</a>              = 10 * NUM_TM_QUEUES;</div><div class="line">    requirements.<a name="a57"></a><a class="code" href="structodp__tm__requirements__t.html#a94fd463da3cb2254ca3e2cc5feeae3ad">num_levels</a>                 = 3;</div><div class="line">    requirements.<a name="a58"></a><a class="code" href="structodp__tm__requirements__t.html#af916b03fe68f56b61c8665ba71f8b63f">tm_queue_shaper_needed</a>     = <span class="keyword">true</span>;</div><div class="line">    requirements.<a name="a59"></a><a class="code" href="structodp__tm__requirements__t.html#a5f1c4b6eee4778c18d0c3b6d8ff26954">tm_queue_wred_needed</a>       = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (level = 0; level &lt; 3; level++) {</div><div class="line">        per_level = &amp;requirements.<a name="a60"></a><a class="code" href="structodp__tm__requirements__t.html#ae7dd9b0ad75602411712bf2181ad3dd8">per_level</a>[level];</div><div class="line">        per_level-&gt;<a name="a61"></a><a class="code" href="structodp__tm__level__requirements__t.html#a5cc43d016d199282f79e02f8fafdbaab">max_num_tm_nodes</a>          = MAX_NODES_PER_LEVEL;</div><div class="line">        per_level-&gt;<a name="a62"></a><a class="code" href="structodp__tm__level__requirements__t.html#a7b0c2bd8cc3870f6d13483313841eba2">max_fanin_per_node</a>        = 64;</div><div class="line">        per_level-&gt;<a name="a63"></a><a class="code" href="structodp__tm__level__requirements__t.html#a8fa30c18c31861b07d49644d9ebd6cf8">max_priority</a>              = 3;</div><div class="line">        per_level-&gt;<a name="a64"></a><a class="code" href="structodp__tm__level__requirements__t.html#a1f31024666b1eb1a218f63ee71cdb475">min_weight</a>                = 1;</div><div class="line">        per_level-&gt;<a name="a65"></a><a class="code" href="structodp__tm__level__requirements__t.html#a1bed595d8008660eebcbf580ea853406">max_weight</a>                = 255;</div><div class="line">        per_level-&gt;<a name="a66"></a><a class="code" href="structodp__tm__level__requirements__t.html#a8940ecc3673e996b6a2e1d4469575692">tm_node_shaper_needed</a>     = <span class="keyword">true</span>;</div><div class="line">        per_level-&gt;<a name="a67"></a><a class="code" href="structodp__tm__level__requirements__t.html#a3143400eaa0aef8019c0734294b7eb2f">tm_node_wred_needed</a>       = <span class="keyword">true</span>;</div><div class="line">        per_level-&gt;<a name="a68"></a><a class="code" href="structodp__tm__level__requirements__t.html#a07085b7ac990f22b663d657417ad36ef">tm_node_dual_slope_needed</a> = <span class="keyword">true</span>;</div><div class="line">        per_level-&gt;<a name="a69"></a><a class="code" href="structodp__tm__level__requirements__t.html#afca683684df926162759ff6d804c9653">fair_queuing_needed</a>       = <span class="keyword">true</span>;</div><div class="line">        per_level-&gt;<a name="a70"></a><a class="code" href="structodp__tm__level__requirements__t.html#a75886e8efbf4320af0cd42236942ca96">weights_needed</a>            = <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    egress.<a name="a71"></a><a class="code" href="structodp__tm__egress__t.html#a2bf166831d409c042f7f919ed6c56c41">egress_kind</a> = ODP_TM_EGRESS_FN;</div><div class="line">    egress.<a name="a72"></a><a class="code" href="structodp__tm__egress__t.html#aeef18986eb3f0df2ead931f9723f2732">egress_fcn</a>  = tester_egress_fcn;</div><div class="line"></div><div class="line">    odp_tm_test = <a name="a73"></a><a class="code" href="group__odp__traffic__mngr.html#ga2bd8513548375cdc720c9c2aab1ec267">odp_tm_create</a>(<span class="stringliteral">&quot;TM test&quot;</span>, &amp;requirements, &amp;egress);</div><div class="line">    err_cnt     = init_profile_sets();</div><div class="line">    <span class="keywordflow">if</span> (err_cnt != 0)</div><div class="line">        printf(<span class="stringliteral">&quot;%s init_profile_sets encountered %&quot;</span> PRIu32 <span class="stringliteral">&quot; errors\n&quot;</span>,</div><div class="line">               __func__, err_cnt);</div><div class="line"></div><div class="line">    config_company_node(<span class="stringliteral">&quot;TestCompany&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> err_cnt;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> uint32_t random_8(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    uint32_t rand8;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (RANDOM_BUF_LEN &lt;= next_rand_byte) {</div><div class="line">        <a name="a74"></a><a class="code" href="group__odp__random.html#ga703757f92891e499e6bbf1d6dc1f3a26">odp_random_data</a>(random_buf, RANDOM_BUF_LEN, 1);</div><div class="line">        next_rand_byte = 0;</div><div class="line">    }</div><div class="line"></div><div class="line">    rand8 = random_buf[next_rand_byte++];</div><div class="line">    <span class="keywordflow">return</span> rand8;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> uint32_t random_16(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    uint8_t byte1, byte2;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ((RANDOM_BUF_LEN - 1) &lt;= next_rand_byte) {</div><div class="line">        <a class="code" href="group__odp__random.html#ga703757f92891e499e6bbf1d6dc1f3a26">odp_random_data</a>(random_buf, RANDOM_BUF_LEN, 1);</div><div class="line">        next_rand_byte = 0;</div><div class="line">    }</div><div class="line"></div><div class="line">    byte1 = random_buf[next_rand_byte++];</div><div class="line">    byte2 = random_buf[next_rand_byte++];</div><div class="line">    <span class="keywordflow">return</span> (((uint16_t)byte1) &lt;&lt; 8) | ((uint16_t)byte2);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> uint32_t pkt_service_class(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    uint32_t rand8;</div><div class="line"></div><div class="line">       <span class="comment">/* Make most of the traffic use service class 3 to increase the amount</span></div><div class="line"><span class="comment">    * of delayed traffic so as to stimulate more interesting behaviors.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    rand8 = random_8();</div><div class="line">    <span class="keywordflow">switch</span> (rand8) {</div><div class="line">    <span class="keywordflow">case</span> 0   ... 24:  <span class="keywordflow">return</span> 0;</div><div class="line">    <span class="keywordflow">case</span> 25  ... 49:  <span class="keywordflow">return</span> 1;</div><div class="line">    <span class="keywordflow">case</span> 50  ... 150: <span class="keywordflow">return</span> 2;</div><div class="line">    <span class="keywordflow">case</span> 151 ... 255: <span class="keywordflow">return</span> 3;</div><div class="line">    <span class="keywordflow">default</span>:          <span class="keywordflow">return</span> 3;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <a class="code" href="struct__odp__abi__packet__t.html">odp_packet_t</a> make_odp_packet(uint16_t pkt_len)</div><div class="line">{</div><div class="line">    <a class="code" href="struct__odp__abi__packet__t.html">odp_packet_t</a> odp_pkt;</div><div class="line">    uint8_t      rand8a, rand8b, pkt_color, drop_eligible;</div><div class="line"></div><div class="line">    rand8a        = random_8();</div><div class="line">    rand8b        = random_8();</div><div class="line">    pkt_color     = (rand8a &lt; 224) ? 0 : ((rand8a &lt; 248) ? 1 : 2);</div><div class="line">    drop_eligible = (rand8b &lt; 240) ? 1 : 0;</div><div class="line">    odp_pkt       = <a name="a75"></a><a class="code" href="group__odp__packet.html#ga7528dda77d71a9dbfe563dffb62d8318">odp_packet_alloc</a>(odp_pool, pkt_len);</div><div class="line">    <span class="keywordflow">if</span> (odp_pkt == <a name="a76"></a><a class="code" href="group__odp__packet.html#gaba8cf39480fb133ab8299155d4ef63dc">ODP_PACKET_INVALID</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;%s odp_packet_alloc failure *******\n&quot;</span>, __func__);</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a name="a77"></a><a class="code" href="group__odp__packet.html#ga0521296b580f66fff46a99d08299b503">odp_packet_color_set</a>(odp_pkt, pkt_color);</div><div class="line">    <a name="a78"></a><a class="code" href="group__odp__packet.html#ga5f580686728b69ce273c2062a1fd8659">odp_packet_drop_eligible_set</a>(odp_pkt, drop_eligible);</div><div class="line">    <a name="a79"></a><a class="code" href="group__odp__packet.html#ga82bf719e0fffac6fc235c0e887f8f4e4">odp_packet_shaper_len_adjust_set</a>(odp_pkt, 24);</div><div class="line">    <span class="keywordflow">return</span> odp_pkt;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> tester_egress_fcn(<a class="code" href="struct__odp__abi__packet__t.html">odp_packet_t</a> odp_pkt <a name="a80"></a><a class="code" href="group__odp__compiler__optim.html#ga45a2684e38da3e71b300bc89de5d6b52">ODP_UNUSED</a>)</div><div class="line">{</div><div class="line">    <a name="a81"></a><a class="code" href="group__odp__atomic.html#ga20dd8163395000df923f3f5112626a2e">odp_atomic_inc_u32</a>(&amp;atomic_pkts_from_tm);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> traffic_generator(uint32_t pkts_to_send)</div><div class="line">{</div><div class="line">    <a name="_a82"></a><a class="code" href="structodp__pool__param__t.html">odp_pool_param_t</a> pool_params;</div><div class="line">    <a class="code" href="group__odp__traffic__mngr.html#ga6c2eab533f6a147a756601b996fc6c1c">odp_tm_queue_t</a>   tm_queue;</div><div class="line">    <a class="code" href="struct__odp__abi__packet__t.html">odp_packet_t</a>     pkt;</div><div class="line">    <a class="code" href="group__odp__system.html#ga0b2a7ca83ccc7af0346db309d8c06d6f">odp_bool_t</a>       tm_is_idle;</div><div class="line">    uint32_t         svc_class, queue_num, pkt_len, pkts_into_tm;</div><div class="line">    uint32_t         pkts_from_tm, pkt_cnt, millisecs, odp_tm_enq_errs;</div><div class="line">    <span class="keywordtype">int</span>              rc;</div><div class="line"></div><div class="line">    memset(&amp;pool_params, 0, <span class="keyword">sizeof</span>(<a class="code" href="structodp__pool__param__t.html">odp_pool_param_t</a>));</div><div class="line">    pool_params.<a name="a83"></a><a class="code" href="structodp__pool__param__t.html#af32325164d425ca91d6849b82467b783">type</a>           = <a name="a84"></a><a class="code" href="group__odp__pool.html#ga74dc6700e25764d2cbc9c01466cee916">ODP_POOL_PACKET</a>;</div><div class="line">    pool_params.<a name="a85"></a><a class="code" href="structodp__pool__param__t.html#a8e93408456d3de6ac0eed6e3228b4b44">pkt</a>.<a name="a86"></a><a class="code" href="structodp__pool__param__t.html#a3598b3a2496629cd45010c1c5e876250">num</a>        = pkts_to_send + 10;</div><div class="line">    pool_params.<a class="code" href="structodp__pool__param__t.html#a8e93408456d3de6ac0eed6e3228b4b44">pkt</a>.<a name="a87"></a><a class="code" href="structodp__pool__param__t.html#ac1ccfa50466f4afa9a9ab72f0bd315bf">len</a>        = 1600;</div><div class="line">    pool_params.<a class="code" href="structodp__pool__param__t.html#a8e93408456d3de6ac0eed6e3228b4b44">pkt</a>.<a name="a88"></a><a class="code" href="structodp__pool__param__t.html#ad400db5955445ee3d1fbb36df456e7f1">seg_len</a>    = 0;</div><div class="line">    pool_params.<a class="code" href="structodp__pool__param__t.html#a8e93408456d3de6ac0eed6e3228b4b44">pkt</a>.<a name="a89"></a><a class="code" href="structodp__pool__param__t.html#a07f656f3afc9bc0212441bf6916d700e">uarea_size</a> = 0;</div><div class="line"></div><div class="line">    odp_pool        = <a name="a90"></a><a class="code" href="group__odp__pool.html#ga256909a276600c25ce11b52ae274632f">odp_pool_create</a>(<span class="stringliteral">&quot;MyPktPool&quot;</span>, &amp;pool_params);</div><div class="line">    odp_tm_enq_errs = 0;</div><div class="line"></div><div class="line">    pkt_cnt = 0;</div><div class="line">    <span class="keywordflow">while</span> (pkt_cnt &lt; pkts_to_send) {</div><div class="line">        svc_class = pkt_service_class();</div><div class="line">        queue_num = random_16() &amp; (TM_QUEUES_PER_CLASS - 1);</div><div class="line">        tm_queue  = queue_num_tbls[svc_class][queue_num];</div><div class="line">        pkt_len   = ((uint32_t)((random_8() &amp; 0x7F) + 2)) * 32;</div><div class="line">        pkt_len   = MIN(pkt_len, 1500);</div><div class="line">        pkt       = make_odp_packet(pkt_len);</div><div class="line"></div><div class="line">        pkt_cnt++;</div><div class="line">        rc = <a name="a91"></a><a class="code" href="group__odp__traffic__mngr.html#ga53fc5b037e0b930eeaf0df38132ff906">odp_tm_enq</a>(tm_queue, pkt);</div><div class="line">        <span class="keywordflow">if</span> (rc &lt; 0) {</div><div class="line">            odp_tm_enq_errs++;</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__odp__atomic.html#ga20dd8163395000df923f3f5112626a2e">odp_atomic_inc_u32</a>(&amp;atomic_pkts_into_tm);</div><div class="line">    }</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;%s odp_tm_enq_errs=%&quot;</span> PRIu32 <span class="stringliteral">&quot;\n&quot;</span>, __func__, odp_tm_enq_errs);</div><div class="line"></div><div class="line">       <span class="comment">/* Wait until the main traffic mgmt worker thread is idle and has no</span></div><div class="line"><span class="comment">    * outstanding events (i.e. no timers, empty work queue, etc), but</span></div><div class="line"><span class="comment">    * not longer than 60 seconds.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="keywordflow">for</span> (millisecs = 0; millisecs &lt; 600000; millisecs++) {</div><div class="line">        usleep(100);</div><div class="line">        tm_is_idle = <a name="a92"></a><a class="code" href="group__odp__traffic__mngr.html#gab37a220ce14bb0a13af9718a499f1b0b">odp_tm_is_idle</a>(odp_tm_test);</div><div class="line">        <span class="keywordflow">if</span> (tm_is_idle)</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!tm_is_idle)</div><div class="line">        printf(<span class="stringliteral">&quot;%s WARNING stopped waiting for the TM system &quot;</span></div><div class="line">               <span class="stringliteral">&quot;to be IDLE!\n&quot;</span>, __func__);</div><div class="line"></div><div class="line">    <span class="comment">/* Wait for up to 2 seconds for pkts_from_tm to match pkts_into_tm. */</span></div><div class="line">    <span class="keywordflow">for</span> (millisecs = 0; millisecs &lt; 2000; millisecs++) {</div><div class="line">        usleep(1000);</div><div class="line">        pkts_into_tm = <a name="a93"></a><a class="code" href="group__odp__atomic.html#ga1ebc0fa6d690c24bd2bcc38bcb9a2276">odp_atomic_load_u32</a>(&amp;atomic_pkts_into_tm);</div><div class="line">        pkts_from_tm = <a class="code" href="group__odp__atomic.html#ga1ebc0fa6d690c24bd2bcc38bcb9a2276">odp_atomic_load_u32</a>(&amp;atomic_pkts_from_tm);</div><div class="line">        <span class="keywordflow">if</span> (pkts_into_tm &lt;= pkts_from_tm)</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> process_cmd_line_options(uint32_t argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    uint32_t arg_idx;</div><div class="line">    <span class="keywordtype">char</span>    *arg;</div><div class="line"></div><div class="line">    arg_idx = 1;</div><div class="line">    <span class="keywordflow">while</span> (arg_idx &lt; argc) {</div><div class="line">        arg = argv[arg_idx++];</div><div class="line">        <span class="keywordflow">if</span> (!arg) {</div><div class="line">            <span class="keywordflow">return</span> -1;</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg[0] == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line">            <span class="keywordflow">switch</span> (arg[1]) {</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div><div class="line">                <span class="keywordflow">if</span> (argc &lt;= arg_idx)</div><div class="line">                    <span class="keywordflow">return</span> -1;</div><div class="line">                g_num_pkts_to_send =</div><div class="line">                    atoi(argv[arg_idx++]);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:</div><div class="line">                g_print_tm_stats = FALSE;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">                printf(<span class="stringliteral">&quot;Unrecognized cmd line option &#39;%s&#39;\n&quot;</span>,</div><div class="line">                       arg);</div><div class="line">                <span class="keywordflow">return</span> -1;</div><div class="line">            }</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            <span class="comment">/* Currently all cmd line options are &#39;-&#39; flag based. */</span></div><div class="line">            <span class="keywordflow">return</span> -1;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> signal_handler(<span class="keywordtype">int</span> signal)</div><div class="line">{</div><div class="line">    <span class="keywordtype">size_t</span> num_stack_frames;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>  *signal_name;</div><div class="line">    <span class="keywordtype">void</span>  *bt_array[128];</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (signal) {</div><div class="line">    <span class="keywordflow">case</span> SIGILL:</div><div class="line">        signal_name = <span class="stringliteral">&quot;SIGILL&quot;</span>;   <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">case</span> SIGFPE:</div><div class="line">        signal_name = <span class="stringliteral">&quot;SIGFPE&quot;</span>;   <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">case</span> SIGSEGV:</div><div class="line">        signal_name = <span class="stringliteral">&quot;SIGSEGV&quot;</span>;  <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">case</span> SIGTERM:</div><div class="line">        signal_name = <span class="stringliteral">&quot;SIGTERM&quot;</span>;  <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">case</span> SIGBUS:</div><div class="line">        signal_name = <span class="stringliteral">&quot;SIGBUS&quot;</span>;   <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        signal_name = <span class="stringliteral">&quot;UNKNOWN&quot;</span>;  <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    num_stack_frames = backtrace(bt_array, 100);</div><div class="line">    printf(<span class="stringliteral">&quot;Received signal=%u (%s) exiting.&quot;</span>, signal, signal_name);</div><div class="line">    backtrace_symbols_fd(bt_array, num_stack_frames, fileno(stderr));</div><div class="line">    fflush(NULL);</div><div class="line">    sync();</div><div class="line">    abort();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> destroy_tm_queues(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> i;</div><div class="line">    <span class="keywordtype">int</span> <span class="keyword">class</span>;</div><div class="line">    <span class="keywordtype">int</span> ret;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NUM_SVC_CLASSES; i++)</div><div class="line">        <span class="keywordflow">for</span> (<span class="keyword">class</span> = 0; <span class="keyword">class </span>&lt; TM_QUEUES_PER_CLASS; <span class="keyword">class</span>++) {</div><div class="line">            <a class="code" href="group__odp__traffic__mngr.html#ga6c2eab533f6a147a756601b996fc6c1c">odp_tm_queue_t</a> tm_queue;</div><div class="line">            <a name="_a94"></a><a class="code" href="structodp__tm__queue__info__t.html">odp_tm_queue_info_t</a> info;</div><div class="line"></div><div class="line">            tm_queue = queue_num_tbls[i][<span class="keyword">class</span>];</div><div class="line"></div><div class="line">            ret = <a name="a95"></a><a class="code" href="group__odp__traffic__mngr.html#gad81d36641fcd01a17e015b5bea4ff3e5">odp_tm_queue_info</a>(tm_queue, &amp;info);</div><div class="line">            <span class="keywordflow">if</span> (ret) {</div><div class="line">                printf(<span class="stringliteral">&quot;Err: odp_tm_queue_info %d\n&quot;</span>, ret);</div><div class="line">                <span class="keywordflow">return</span> -1;</div><div class="line">            }</div><div class="line"></div><div class="line">            ret = <a name="a96"></a><a class="code" href="group__odp__traffic__mngr.html#ga4d907b8b6a9a04106d1463ad0ca801ed">odp_tm_node_disconnect</a>(info.<a name="a97"></a><a class="code" href="structodp__tm__queue__info__t.html#a83bb161fb4321992c1f2a3f17ba8e303">next_tm_node</a>);</div><div class="line">            <span class="keywordflow">if</span> (ret) {</div><div class="line">                printf(<span class="stringliteral">&quot;Err: odp_tm_node_disconnect %d\n&quot;</span>, ret);</div><div class="line">                <span class="keywordflow">return</span> -1;</div><div class="line">            }</div><div class="line"></div><div class="line">            ret =  <a name="a98"></a><a class="code" href="group__odp__traffic__mngr.html#gaca726b281532e898f26ad8a07ff80860">odp_tm_queue_disconnect</a>(tm_queue);</div><div class="line">            <span class="keywordflow">if</span> (ret) {</div><div class="line">                printf(<span class="stringliteral">&quot;odp_tm_queue_disconnect %d\n&quot;</span>, ret);</div><div class="line">                <span class="keywordflow">return</span> -1;</div><div class="line">            }</div><div class="line"></div><div class="line">            ret = <a name="a99"></a><a class="code" href="group__odp__traffic__mngr.html#gac4003a0d74370eb2997bce8885625d9a">odp_tm_queue_destroy</a>(tm_queue);</div><div class="line">            <span class="keywordflow">if</span> (ret) {</div><div class="line">                printf(<span class="stringliteral">&quot;odp_tm_queue_destroy %d\n&quot;</span>, ret);</div><div class="line">                <span class="keywordflow">return</span> -1;</div><div class="line">            }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="keyword">struct </span>sigaction signal_action;</div><div class="line">    <span class="keyword">struct </span>rlimit    rlimit;</div><div class="line">    uint32_t pkts_into_tm, pkts_from_tm;</div><div class="line">    <a class="code" href="group__odp__initialization.html#ga8d362bd3c7c87ab5892ca63b15c375c0">odp_instance_t</a> instance;</div><div class="line">    <span class="keywordtype">int</span> rc;</div><div class="line"></div><div class="line">    memset(&amp;signal_action, 0, <span class="keyword">sizeof</span>(signal_action));</div><div class="line">    signal_action.sa_handler = signal_handler;</div><div class="line">    sigfillset(&amp;signal_action.sa_mask);</div><div class="line">    sigaction(SIGILL,  &amp;signal_action, NULL);</div><div class="line">    sigaction(SIGFPE,  &amp;signal_action, NULL);</div><div class="line">    sigaction(SIGSEGV, &amp;signal_action, NULL);</div><div class="line">    sigaction(SIGTERM, &amp;signal_action, NULL);</div><div class="line">    sigaction(SIGBUS,  &amp;signal_action, NULL);</div><div class="line"></div><div class="line">    getrlimit(RLIMIT_CORE, &amp;rlimit);</div><div class="line">    rlimit.rlim_cur = rlimit.rlim_max;</div><div class="line">    setrlimit(RLIMIT_CORE, &amp;rlimit);</div><div class="line"></div><div class="line">    rc = <a name="a100"></a><a class="code" href="group__odp__initialization.html#ga68d81088e65ef66180fb51076905e34d">odp_init_global</a>(&amp;instance, &amp;ODP_INIT_PARAMS, NULL);</div><div class="line">    <span class="keywordflow">if</span> (rc != 0) {</div><div class="line">        printf(<span class="stringliteral">&quot;Error: odp_init_global() failed, rc = %d\n&quot;</span>, rc);</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    rc = <a name="a101"></a><a class="code" href="group__odp__initialization.html#ga265470ea614bfeca9d8901e81ddefca9">odp_init_local</a>(instance, <a name="a102"></a><a class="code" href="group__odp__thread.html#ggafc7a7c180de9811d71b7cb050713bf53a9aab3fdb10eb2000a864bff81f23c00a">ODP_THREAD_CONTROL</a>);</div><div class="line">    <span class="keywordflow">if</span> (rc != 0) {</div><div class="line">        printf(<span class="stringliteral">&quot;Error: odp_init_local() failed, rc = %d\n&quot;</span>, rc);</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (process_cmd_line_options(argc, argv) &lt; 0)</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line"></div><div class="line">    create_and_config_tm();</div><div class="line"></div><div class="line">    <a class="code" href="group__odp__random.html#ga703757f92891e499e6bbf1d6dc1f3a26">odp_random_data</a>(random_buf, RANDOM_BUF_LEN, 1);</div><div class="line">    next_rand_byte = 0;</div><div class="line"></div><div class="line">    <a name="a103"></a><a class="code" href="group__odp__atomic.html#ga0029015adacaadb06ee94ea67d00eece">odp_atomic_init_u32</a>(&amp;atomic_pkts_into_tm, 0);</div><div class="line">    <a class="code" href="group__odp__atomic.html#ga0029015adacaadb06ee94ea67d00eece">odp_atomic_init_u32</a>(&amp;atomic_pkts_from_tm, 0);</div><div class="line"></div><div class="line">    traffic_generator(g_num_pkts_to_send);</div><div class="line"></div><div class="line">    pkts_into_tm = <a class="code" href="group__odp__atomic.html#ga1ebc0fa6d690c24bd2bcc38bcb9a2276">odp_atomic_load_u32</a>(&amp;atomic_pkts_into_tm);</div><div class="line">    pkts_from_tm = <a class="code" href="group__odp__atomic.html#ga1ebc0fa6d690c24bd2bcc38bcb9a2276">odp_atomic_load_u32</a>(&amp;atomic_pkts_from_tm);</div><div class="line">    printf(<span class="stringliteral">&quot;pkts_into_tm=%&quot;</span> PRIu32 <span class="stringliteral">&quot; pkts_from_tm=%&quot;</span> PRIu32 <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line">           pkts_into_tm, pkts_from_tm);</div><div class="line"></div><div class="line">    <a name="a104"></a><a class="code" href="group__odp__traffic__mngr.html#ga9d453c608deedbae45fb5cf343686318">odp_tm_stats_print</a>(odp_tm_test);</div><div class="line"></div><div class="line">    rc = destroy_tm_queues();</div><div class="line">    <span class="keywordflow">if</span> (rc != 0) {</div><div class="line">        printf(<span class="stringliteral">&quot;Error: destroy_tm_queues() failed, rc = %d\n&quot;</span>, rc);</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    rc = <a name="a105"></a><a class="code" href="group__odp__pool.html#ga6ad439aaef911d82b972c915850e6924">odp_pool_destroy</a>(odp_pool);</div><div class="line">    <span class="keywordflow">if</span> (rc != 0) {</div><div class="line">        printf(<span class="stringliteral">&quot;Error: odp_pool_destroy() failed, rc = %d\n&quot;</span>, rc);</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    rc = <a name="a106"></a><a class="code" href="group__odp__traffic__mngr.html#ga359a2afd697cdfa5341916762ea467f2">odp_tm_destroy</a>(odp_tm_test);</div><div class="line">    <span class="keywordflow">if</span> (rc != 0) {</div><div class="line">        printf(<span class="stringliteral">&quot;Error: odp_tm_destroy() failed, rc = %d\n&quot;</span>, rc);</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    rc = <a name="a107"></a><a class="code" href="group__odp__initialization.html#ga6d15f0e1718da9477948dedb06a2f01a">odp_term_local</a>();</div><div class="line">    <span class="keywordflow">if</span> (rc != 0) {</div><div class="line">        printf(<span class="stringliteral">&quot;Error: odp_term_local() failed, rc = %d\n&quot;</span>, rc);</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    rc = <a name="a108"></a><a class="code" href="group__odp__initialization.html#ga87e9c66ad92201c9e0a710294eab1569">odp_term_global</a>(instance);</div><div class="line">    <span class="keywordflow">if</span> (rc != 0) {</div><div class="line">        printf(<span class="stringliteral">&quot;Error: odp_term_global() failed, rc = %d\n&quot;</span>, rc);</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;Quit\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
